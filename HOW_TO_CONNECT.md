# ğŸ”— å‰åç«¯åˆ†ç¦»éƒ¨ç½²è¿æ¥æŒ‡å—

## ğŸ“Š æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         HTTP è¯·æ±‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯ (Vercel)  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  åç«¯ (Railway) â”‚
â”‚  React åº”ç”¨      â”‚                          â”‚  Python FastAPI â”‚
â”‚  https://xxx    â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  https://yyy    â”‚
â”‚  .vercel.app    â”‚      JSON å“åº”/SSE       â”‚  .railway.app   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ è¿æ¥æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½²åç«¯ï¼ˆè·å–åç«¯åœ°å€ï¼‰

**ä½¿ç”¨ Railway éƒ¨ç½²åç«¯ï¼š**

1. è®¿é—®ï¼šhttps://railway.app
2. ä½¿ç”¨ GitHub ç™»å½•
3. ç‚¹å‡» "New Project" â†’ "Deploy from GitHub repo"
4. é€‰æ‹©ä½ çš„ `fortune-app` ä»“åº“
5. Railway ä¼šè‡ªåŠ¨æ£€æµ‹ Python é¡¹ç›®
6. é…ç½®ç¯å¢ƒå˜é‡ï¼š
   - `COMPASS_API_KEY`: ä½ çš„ Compass API key
   - `DEEPSEEK_API_KEY`: ä½ çš„ DeepSeek API keyï¼ˆå¦‚æœæœ‰ï¼‰
   - `ALLOWED_ORIGINS`: æš‚æ—¶ç•™ç©ºï¼ˆåé¢ä¼šæ›´æ–°ï¼‰
7. éƒ¨ç½²å®Œæˆåï¼ŒRailway ä¼šç»™ä½ ä¸€ä¸ª URLï¼Œä¾‹å¦‚ï¼š
   ```
   https://fortune-app-production.up.railway.app
   ```
   **è¿™å°±æ˜¯ä½ çš„åç«¯åœ°å€ï¼** ğŸ“

### ç¬¬äºŒæ­¥ï¼šéƒ¨ç½²å‰ç«¯ï¼ˆé…ç½®åç«¯åœ°å€ï¼‰

**ä½¿ç”¨ Vercel éƒ¨ç½²å‰ç«¯ï¼š**

1. è®¿é—®ï¼šhttps://vercel.com
2. å¯¼å…¥ `fortune-app` ä»“åº“
3. é…ç½®ï¼š
   - **Root Directory**: `frontend`
   - **Build Command**: ç•™ç©º
   - **Output Directory**: `dist`
4. **æ·»åŠ ç¯å¢ƒå˜é‡**ï¼ˆå…³é”®ï¼ï¼‰ï¼š
   - **Key**: `VITE_API_BASE_URL`
   - **Value**: ä½ çš„ Railway åç«¯åœ°å€ï¼ˆå¦‚ `https://fortune-app-production.up.railway.app`ï¼‰
   - **Environment**: å…¨é€‰
5. ç‚¹å‡» "Deploy"
6. Vercel ä¼šç»™ä½ ä¸€ä¸ª URLï¼Œä¾‹å¦‚ï¼š
   ```
   https://fortune-app.vercel.app
   ```
   **è¿™å°±æ˜¯ä½ çš„å‰ç«¯åœ°å€ï¼** ğŸ“

### ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°åç«¯ CORSï¼ˆå…è®¸å‰ç«¯è®¿é—®ï¼‰

**åœ¨ Railway åç«¯ç¯å¢ƒå˜é‡ä¸­ï¼š**

1. è¿›å…¥ Railway é¡¹ç›®
2. ç‚¹å‡» "Variables" æ ‡ç­¾
3. æ·»åŠ æˆ–æ›´æ–°ï¼š
   - **Key**: `ALLOWED_ORIGINS`
   - **Value**: ä½ çš„ Vercel å‰ç«¯åœ°å€ï¼ˆå¦‚ `https://fortune-app.vercel.app`ï¼‰
   - å¦‚æœæœ‰å¤šä¸ªåŸŸåï¼Œç”¨é€—å·åˆ†éš”ï¼š
     ```
     https://fortune-app.vercel.app,https://fortune-app-git-main.vercel.app
     ```
4. Railway ä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²

### ç¬¬å››æ­¥ï¼šéªŒè¯è¿æ¥

1. **è®¿é—®å‰ç«¯åœ°å€**ï¼š`https://fortune-app.vercel.app`
2. **æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·**ï¼ˆF12ï¼‰
3. **æŸ¥çœ‹ Network æ ‡ç­¾**ï¼š
   - åº”è¯¥èƒ½çœ‹åˆ°å¯¹åç«¯ API çš„è¯·æ±‚
   - è¯·æ±‚ URL åº”è¯¥æ˜¯ï¼š`https://fortune-app-production.up.railway.app/api/...`
4. **æ£€æŸ¥æ˜¯å¦æœ‰ CORS é”™è¯¯**ï¼š
   - å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œè¯´æ˜è¿æ¥æˆåŠŸï¼âœ…
   - å¦‚æœæœ‰ CORS é”™è¯¯ï¼Œæ£€æŸ¥ `ALLOWED_ORIGINS` é…ç½®

## ğŸ” å·¥ä½œåŸç†

### å‰ç«¯å¦‚ä½•çŸ¥é“åç«¯åœ°å€ï¼Ÿ

**é€šè¿‡ç¯å¢ƒå˜é‡ï¼š**

```javascript
// frontend/src/utils/api.js
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8000';
```

- å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨ `http://localhost:8000`ï¼ˆæœ¬åœ°åç«¯ï¼‰
- ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨ Vercel ç¯å¢ƒå˜é‡ `VITE_API_BASE_URL`ï¼ˆRailway åç«¯åœ°å€ï¼‰

### åç«¯å¦‚ä½•å…è®¸å‰ç«¯è®¿é—®ï¼Ÿ

**é€šè¿‡ CORS é…ç½®ï¼š**

```python
# main.py
ALLOWED_ORIGINS = os.getenv("ALLOWED_ORIGINS", "*").split(",")
```

- å¼€å‘ç¯å¢ƒï¼šå…è®¸æ‰€æœ‰åŸŸåï¼ˆ`*`ï¼‰
- ç”Ÿäº§ç¯å¢ƒï¼šåªå…è®¸é…ç½®çš„åŸŸåï¼ˆä½ çš„ Vercel åœ°å€ï¼‰

## ğŸ“‹ å®Œæ•´é…ç½®æ¸…å•

### Railwayï¼ˆåç«¯ï¼‰ç¯å¢ƒå˜é‡ï¼š

```
COMPASS_API_KEY=ä½ çš„_compass_api_key
DEEPSEEK_API_KEY=ä½ çš„_deepseek_api_keyï¼ˆå¯é€‰ï¼‰
ALLOWED_ORIGINS=https://fortune-app.vercel.app,https://fortune-app-git-main.vercel.app
```

### Vercelï¼ˆå‰ç«¯ï¼‰ç¯å¢ƒå˜é‡ï¼š

```
VITE_API_BASE_URL=https://fortune-app-production.up.railway.app
```

## ğŸš¨ å¸¸è§é—®é¢˜

### é—®é¢˜ 1: CORS é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Access to fetch at 'https://xxx.railway.app/api/...' from origin 'https://xxx.vercel.app' has been blocked by CORS policy
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ Railway çš„ `ALLOWED_ORIGINS` ç¯å¢ƒå˜é‡
2. ç¡®ä¿åŒ…å«å®Œæ•´çš„å‰ç«¯ URLï¼ˆåŒ…æ‹¬ `https://`ï¼‰
3. å¦‚æœæœ‰å¤šä¸ª Vercel åŸŸåï¼Œéƒ½è¦æ·»åŠ 

### é—®é¢˜ 2: 404 Not Found

**é”™è¯¯ä¿¡æ¯ï¼š**
```
GET https://xxx.railway.app/api/fortune 404
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥åç«¯ URL æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤åç«¯å·²æˆåŠŸéƒ¨ç½²
3. è®¿é—®åç«¯å¥åº·æ£€æŸ¥ï¼š`https://xxx.railway.app/health`

### é—®é¢˜ 3: ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ

**é—®é¢˜ï¼š** å‰ç«¯ä»ç„¶ä½¿ç”¨ `localhost:8000`

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤ Vercel ç¯å¢ƒå˜é‡åç§°æ˜¯ `VITE_API_BASE_URL`ï¼ˆå¿…é¡»ä»¥ `VITE_` å¼€å¤´ï¼‰
2. é‡æ–°éƒ¨ç½²å‰ç«¯ï¼ˆç¯å¢ƒå˜é‡æ›´æ”¹åéœ€è¦é‡æ–°éƒ¨ç½²ï¼‰
3. æ£€æŸ¥æ„å»ºæ—¥å¿—ï¼Œç¡®è®¤ç¯å¢ƒå˜é‡è¢«æ­£ç¡®æ³¨å…¥

## âœ… éªŒè¯æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œæ£€æŸ¥ï¼š

- [ ] åç«¯éƒ¨ç½²æˆåŠŸï¼Œå¯ä»¥è®¿é—® `https://xxx.railway.app/health`
- [ ] å‰ç«¯éƒ¨ç½²æˆåŠŸï¼Œå¯ä»¥è®¿é—® `https://xxx.vercel.app`
- [ ] Vercel ç¯å¢ƒå˜é‡ `VITE_API_BASE_URL` å·²è®¾ç½®
- [ ] Railway ç¯å¢ƒå˜é‡ `ALLOWED_ORIGINS` å·²è®¾ç½®
- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸è°ƒç”¨åç«¯ API
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ²¡æœ‰ CORS é”™è¯¯

## ğŸ¯ æ€»ç»“

**å‰åç«¯åˆ†ç¦»éƒ¨ç½²çš„è¿æ¥æ–¹å¼ï¼š**

1. **å‰ç«¯é€šè¿‡ç¯å¢ƒå˜é‡çŸ¥é“åç«¯åœ°å€**
   - å¼€å‘ï¼š`localhost:8000`
   - ç”Ÿäº§ï¼šRailway åç«¯åœ°å€

2. **åç«¯é€šè¿‡ CORS å…è®¸å‰ç«¯è®¿é—®**
   - å¼€å‘ï¼šå…è®¸æ‰€æœ‰
   - ç”Ÿäº§ï¼šåªå…è®¸ Vercel åŸŸå

3. **é€šè¿‡ HTTP è¯·æ±‚é€šä¿¡**
   - å‰ç«¯å‘é€è¯·æ±‚åˆ°åç«¯
   - åç«¯è¿”å› JSON æˆ– SSE æµå¼æ•°æ®

**å°±æ˜¯è¿™æ ·ï¼å‰åç«¯é€šè¿‡ HTTP åè®®é€šä¿¡ï¼Œå°±åƒè®¿é—®ä»»ä½•ç½‘ç«™ä¸€æ ·ï¼** ğŸŒ
