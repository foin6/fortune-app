# K 线图生成功能测试清单

## 服务状态检查

### 后端服务
- ✅ 端口: 8000
- ✅ 健康检查: `http://localhost:8000/health`
- ✅ 状态: 运行中

### 前端服务
- ⚠️ 需要手动启动: `cd frontend && npm run dev`
- 默认端口: 5173
- 访问地址: `http://localhost:5173/kline`

## 测试步骤

### 1. 基础功能测试
- [ ] 打开前端页面: `http://localhost:5173/kline`
- [ ] 填写表单（或选择已有命书）
- [ ] 点击"生成 K 线图"按钮
- [ ] 观察加载状态

### 2. 数据格式验证
- [ ] 检查浏览器控制台（F12）是否有错误
- [ ] 查看 Network 标签，检查 `/api/generate-kline` 请求
- [ ] 验证响应格式是否为:
  ```json
  {
    "success": true,
    "data": {
      "chart_data": {
        "years": [...],
        "career": [...],
        "wealth": [...],
        "love": [...]
      },
      "analysis_text": "..."
    }
  }
  ```

### 3. 性能测试
- [ ] 记录响应时间（应该比之前更快）
- [ ] 检查后端日志，确认使用了 JSON 模式
- [ ] 验证返回数据无 Markdown 标记（```json）

### 4. 前端显示测试
- [ ] 成功跳转到 `/kline-result` 页面
- [ ] 图表正常显示（3条曲线：事业、财富、情感）
- [ ] AI 解读文本正常显示
- [ ] 命盘信息正常显示

### 5. 错误处理测试
- [ ] 测试无效输入（如日期格式错误）
- [ ] 测试网络错误（断开后端）
- [ ] 验证错误提示是否友好

## 预期结果

### 成功场景
✅ 响应速度明显提升（JSON 模式）
✅ 返回干净的 JSON 数据（无 Markdown）
✅ 前端正确解析并显示图表
✅ 3条曲线正常显示（事业、财富、情感）
✅ AI 解读文本正常显示

### 失败场景处理
- 如果 API 调用失败，应该显示友好的错误提示
- 如果数据格式错误，应该有兜底数据

## 调试信息

### 后端日志关键词
- `📊 开始调用 LLM 生成 K 线数据（强制 JSON 模式）`
- `✅ 使用 config 参数设置 JSON 格式`
- `✅ JSON 解析成功`
- `📥 LLM 返回原始内容长度: XXX`

### 前端控制台关键词
- `📤 调用 generateKLineChart API`
- `✅ API 调用成功，返回数据`
- `📊 图表数据: {career, wealth, love}`

## 常见问题

### 问题1: 前端显示空白
- 检查 `klineData.chart_data` 是否存在
- 检查数据格式是否正确
- 查看浏览器控制台错误

### 问题2: 图表不显示
- 检查 ECharts 是否正确初始化
- 检查数据数组长度是否为 41
- 检查 `chartRef.current` 是否存在

### 问题3: API 返回错误
- 检查后端日志
- 检查 JSON 解析是否成功
- 检查 DeepSeek API 配置

## 测试完成标准

- [ ] 所有基础功能测试通过
- [ ] 数据格式验证通过
- [ ] 性能测试通过（响应时间 < 10秒）
- [ ] 前端显示测试通过
- [ ] 错误处理测试通过

---

**测试日期**: $(date)
**测试人员**: 待填写
**测试结果**: 待填写
